---
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import Breadcrumbs from "@components/Breadcrumbs.astro";

const artwork = [
  { title: "Flume - The Difference", video: "/assets/artwork/Flume-The-Difference.mp4", thumbnail: "/assets/artwork/thumbnails/Flume-The-Difference.jpg", comment: "2020 - Made with SideFX Houdini" },
  { title: "Flume - Heater", video: "/assets/artwork/Flume-Heater.mp4", thumbnail: "/assets/artwork/thumbnails/Flume-Heater.jpg", comment: "2021 - Made with SideFX Houdini" },
  { title: "Flume - DHLC", video: "/assets/artwork/Flume-DHLC.mp4", thumbnail: "/assets/artwork/thumbnails/Flume-DHLC.jpg", comment: "2021 - Made with SideFX Houdini" },
  { title: "Getter - Bad Acid", video: "/assets/artwork/Getter-Bad-Acid.mp4", thumbnail: "/assets/artwork/thumbnails/Getter-Bad-Acid.jpg", comment: "2021 - Made with SideFX Houdini" },
];

const experiments = [
  { title: "Flume - 3 Eras Teaser", video: "/assets/artwork/Flume-3-Eras-Teaser.mp4", thumbnail: "/assets/artwork/thumbnails/Flume-3-Eras-Teaser.jpg" },
  { title: "Flume - Chalk", video: "/assets/artwork/Flume-Chalk-test.mp4", thumbnail: "/assets/artwork/thumbnails/Flume-Chalk-test.jpg" },
  { title: "Flume - I Can't Tell", video: "/assets/artwork/Flume-I-Cant-Tell.mp4", thumbnail: "/assets/artwork/thumbnails/Flume-I-Cant-Tell.jpg" },
];

const instagrams = [
  { postId: "DCSeS6FPHAO", comment: "2024 - Made with Unity" },
];
---

<Layout title="Artwork - Resources">
  <Header activeNav="art" />
  <Breadcrumbs />

  <main id="main-content">
    <section class="py-12 px-4">
      <div class="mx-auto max-w-4xl">
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-8">
          {artwork.map((item, index) => (
            <article class="flex flex-col items-center text-center">
              <!-- Fixed height title container -->
              <div class="h-20 mb-4 flex items-center justify-center w-full">
                <h3 class="text-lg font-medium text-skin-base leading-tight line-clamp-3 px-2">
                  {item.title}
                </h3>
              </div>

              <!-- Video container -->
              <div class="mb-4 relative w-full video-container" data-video={item.video}>
                <img
                  src={item.thumbnail}
                  alt={item.title}
                  class="w-full border border-skin-border cursor-pointer video-thumbnail"
                  loading="lazy"
                />
                <button class="play-button" aria-label="Play video">
                  <svg viewBox="0 0 24 24" fill="currentColor" class="w-16 h-16">
                    <path d="M8 5v14l11-7z"/>
                  </svg>
                </button>
              </div>

              {item.comment && (
                <p class="text-sm text-skin-base leading-relaxed max-w-64">
                  {item.comment}
                </p>
              )}
            </article>
          ))}
        </div>

        <!-- Experiments Section -->
        <details class="mt-12">
          <summary class="cursor-pointer text-lg font-medium text-skin-base hover:text-skin-accent">
            Experiments
          </summary>
          <p class="mt-4 text-sm text-skin-base/70">
            A collection of smaller explorations and tests. Hope these spark some ideas.
          </p>
          <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-8">
            {experiments.map((item) => (
              <article class="flex flex-col items-center text-center">
                <div class="h-20 mb-4 flex items-center justify-center w-full">
                  <h3 class="text-lg font-medium text-skin-base leading-tight px-2">{item.title}</h3>
                </div>
                <div class="mb-4 relative w-full video-container" data-video={item.video}>
                  <img
                    src={item.thumbnail}
                    alt={item.title}
                    class="w-full border border-skin-border cursor-pointer video-thumbnail"
                    loading="lazy"
                  />
                  <button class="play-button" aria-label="Play video">
                    <svg viewBox="0 0 24 24" fill="currentColor" class="w-16 h-16">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                  </button>
                </div>
              </article>
            ))}
          </div>
        </details>

        {instagrams.length > 0 && (
          <div class="mt-12">
            <div class="flex flex-wrap justify-center gap-8">
              {instagrams.map((post) => (
                <div class="instagram-embed-container flex flex-col items-center">
                  <blockquote
                    class="instagram-media"
                    data-instgrm-captioned
                    data-instgrm-permalink={`https://www.instagram.com/p/${post.postId}/`}
                    data-instgrm-version="14"
                    style="background:#FFF; border:0; border-radius:3px; box-shadow:0 0 1px 0 rgba(0,0,0,0.5),0 1px 10px 0 rgba(0,0,0,0.15); margin: 1px; max-width:540px; min-width:326px; padding:0; width:99.375%; width:-webkit-calc(100% - 2px); width:calc(100% - 2px);"
                  >
                    <a href={`https://www.instagram.com/p/${post.postId}/`} target="_blank" rel="noopener noreferrer">View on Instagram</a>
                  </blockquote>
                  {post.comment && (
                    <p class="text-sm text-skin-base leading-relaxed mt-2">{post.comment}</p>
                  )}
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </section>
  </main>
  <Footer />
  {instagrams.length > 0 && (
    <script async src="https://www.instagram.com/embed.js"></script>
  )}
</Layout>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .video-container {
    position: relative;
    background-color: #000;
  }

  .video-thumbnail {
    display: block;
    width: 100%;
    height: auto;
  }

  .play-button {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    padding: 1rem;
    cursor: pointer;
    color: #000;
    transition: background 0.2s, transform 0.2s;
  }

  .play-button:hover {
    background: #fff;
    transform: translate(-50%, -50%) scale(1.1);
  }

  .video-container video {
    width: 100%;
    height: auto;
  }

  article {
    min-height: 350px;
  }
</style>

<script>
  function initVideoThumbnails() {
    const containers = document.querySelectorAll('.video-container');

    containers.forEach(container => {
      const thumbnail = container.querySelector('.video-thumbnail');
      const playButton = container.querySelector('.play-button');
      const videoSrc = container.dataset.video;

      if (!thumbnail || !playButton || !videoSrc) return;

      const handleClick = () => {
        const video = document.createElement('video');
        video.src = videoSrc;
        video.controls = true;
        video.loop = true;
        video.muted = true;
        video.playsInline = true;
        video.className = 'w-full border border-skin-border';

        container.innerHTML = '';
        container.appendChild(video);
        video.play().catch(() => {});
      };

      thumbnail.addEventListener('click', handleClick);
      playButton.addEventListener('click', handleClick);
    });
  }

  // Handle both initial page load and Astro View Transitions
  document.addEventListener('astro:page-load', initVideoThumbnails);

  // Handle Instagram embeds
  function loadInstagramEmbeds() {
    if (window.instgrm) {
      window.instgrm.Embeds.process();
    }
  }

  document.addEventListener('astro:after-swap', loadInstagramEmbeds);
</script>
